#!/usr/bin/env zsh

asdf update

for plugin in $(asdf list | grep -e "^\w"); do
    echo -n "$plugin: "
    current=${=$(asdf list $plugin | tail -n 1)}
    echo -n "current $current "
    versions=(${=$(asdf list-all $plugin)})
    last=$versions[-1]
    echo -n "last $last "
    if [[ "$current" == "$last" ]]; then
        echo "→ keep"
        continue
    else
        echo "→ update"
        selected=$(printf '%s\n' "${versions[@]}" | tac | fzf --layout=reverse --no-sort --header "Select $plugin version to use (or press ESC to skip):")
        if [[ -n "$selected" ]]; then
            echo "Installing $plugin $selected..."
            asdf install $plugin $selected
            echo "Setting $plugin $selected as global dfault version..."
            asdf global $plugin $selected
        fi
    fi
done

echo done
